/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-badges",
factory: function (require) {
"use strict";var plugin=(()=>{var E=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var n=(a=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(a,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):a)(function(a){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+a+'" is not supported')});var q=(a,t)=>{for(var r in t)E(a,r,{get:t[r],enumerable:!0})},z=(a,t,r,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let m of V(t))!K.call(a,m)&&m!==r&&E(a,m,{get:()=>t[m],enumerable:!(g=M(t,m))||g.enumerable});return a};var J=a=>z(E({},"__esModule",{value:!0}),a);var Q={};q(Q,{BadgesCommand:()=>l,default:()=>$});var O=n("@yarnpkg/cli"),P=n("@yarnpkg/cli"),j=n("@yarnpkg/core"),G=n("@yarnpkg/core"),T=n("@yarnpkg/core"),h=n("@yarnpkg/core"),C=n("@yarnpkg/core"),D=n("fs"),W=n("fs"),A=n("path");var v=n("@yarnpkg/core"),w=n("@yarnpkg/core"),d=class{constructor(t,r){this.stdout=t;this.configuration=r;this.running=!1;this.position=0}start(){this.stdout.isTTY&&!process.env.TOOLS_DISABLE_PROGRESS&&(this.running=!0,this.write(),this.tick())}end(){this.stdout.isTTY&&this.running&&(this.running=!1,this.clear(!0))}tick(){setTimeout(()=>{this.running&&(this.clear(),this.write(),this.position=this.position===d.PROGRESS_FRAMES.length-1?0:this.position+1,this.tick())},d.PROGRESS_INTERVAL)}write(){let t=d.PROGRESS_FRAMES[this.position],r=w.formatUtils.pretty(this.configuration,`YN${v.MessageName.UNNAMED.toString(10).padStart(4,"0")}`,"gray");this.stdout.write(`${w.formatUtils.pretty(this.configuration,"\u27A4","blueBright")} ${r}: \u2502 ${t}
`)}clear(t=!1){this.stdout.write(`\x1B[${0}A`),t&&this.stdout.write("\x1B[0J")}},f=d;f.PROGRESS_FRAMES=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"],f.PROGRESS_INTERVAL=120;var L=["@atls/code-service","@atls/schematics","@atls/next-identity-integration","@atls/react-kratos-browser-flows","@atls/nestjs-dataloader","@atls/nestjs-external-renderer","@atls/nestjs-gateway","@atls/nestjs-grpc-errors","@atls/nestjs-grpc-http-proxy","@atls/nestjs-grpc-identity","@atls/nestjs-grpc-playground","@atls/nestjs-grpc-reflection","@atls/nestjs-hydra","@atls/nestjs-keto","@atls/nestjs-kratos","@atls/nestjs-typesense-typeorm","@atls/nestjs-typesense","@atls-ui-generators/button","@atls-ui-generators/input","@atls-ui-generators/icons"],y={"@atls/nestjs":{labelColor:"#CB5458",color:"#BE4045"},"@atls/next":{labelColor:"#354247",color:"#1D282D"},"@atls/react":{labelColor:"#43CFF4",color:"#2DBFE6"},"@atls-ui":{labelColor:"#097CEB",color:"#0B6DCC"},tools:{labelColor:"#ECEEF5",color:"#D7DCEB"}};var u=class extends O.BaseCommand{async execute(){let t=await G.Configuration.find(this.context.cwd,this.context.plugins),{project:r,workspace:g}=await T.Project.find(t,this.context.cwd);if(!g)throw new P.WorkspaceRequiredError(r.cwd,this.context.cwd);return await r.restoreInstallState(),(await j.StreamReport.start({stdout:this.context.stdout,configuration:t},async I=>{await I.startTimerPromise("Generating badges",async()=>{let x=new f(this.context.stdout,t);x.start();let B=e=>{let o=e.anchoredLocator.locatorHash,c=new Map,i=[o];for(;i.length>0;){let p=i.shift();if(c.has(p))continue;let s=r.storedPackages.get(p);if(typeof s>"u")throw new Error("Assertion failed: Expected the package to be registered");if(c.set(p,s),h.structUtils.isVirtualLocator(s)&&i.push(h.structUtils.devirtualizeLocator(s).locatorHash),p===o)for(let b of s.dependencies.values()){let R=r.storedResolutions.get(b.descriptorHash);if(typeof R>"u")throw new Error("Assertion failed: Expected the resolution to be registered");i.push(R)}}return c.values()},_=(()=>{let e=new Map;for(let o of r.workspaces)for(let c of B(o))e.set(c.locatorHash,c);return e.values()})(),H=C.miscUtils.sortMap([..._],e=>h.structUtils.stringifyLocator(e)),Y=async e=>{let o=h.structUtils.parseDescriptor(e),c=H.filter(i=>i.scope===o.scope&&i.name===o.name);return c.length>0?c.shift().version:""},k=(0,A.join)(process.cwd(),"README.md"),S=(0,D.readFileSync)(k).toString("utf-8").split(u.VERSIONS_SEPARATOR),N=await Promise.all(L.map(async e=>({name:e,version:await Y(e)}))),U=(e,o)=>{let c=()=>{let i=s=>({labelColor:s.labelColor.replace("#",""),color:s.color.replace("#","")}),p=Object.entries(y).find(([s])=>o.name.search(s)!==-1);if(p){let[,s]=p;return i(s)}return i(y.tools)};if(o.version){let i=`${u.REGISTRY_URL}${u.REGISTRY_PACKAGE_PATH}/${o.name}`;(0,A.join)(u.REGISTRY_URL,u.REGISTRY_PACKAGE_PATH,o.name);let p=new URLSearchParams({style:u.BADGE_STYLE,label:o.name,message:o.version,...c()}),s=`<img src="${u.BADGE_URL}?${p.toString()}" alt='badge'>`;return`${e}${((R,F)=>`[${R}](${F})`)(s,i)}  `}return e};S[1]=N.reduce(U,""),S[1]=`

${S[1]}

`,(0,W.writeFileSync)(k,S.join("[//]: # (VERSIONS)")),x.end()})})).exitCode()}},l=u;l.paths=[["badges","generate"]],l.VERSIONS_SEPARATOR="[//]: # (VERSIONS)",l.BADGE_URL="https://img.shields.io/static/v1",l.BADGE_STYLE="for-the-badge",l.REGISTRY_URL="https://npmjs.com",l.REGISTRY_PACKAGE_PATH="/package";var $={commands:[l]};return J(Q);})();
return plugin;
}
};
